<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>ç¬¬å…«è®²ï¼šå›¾å½¢è¯­æ³•ä¸æ•°æ®å¯è§†åŒ–</title>
    <meta charset="utf-8" />
    <meta name="author" content="å²å†¬æ³¢" />
    <meta name="date" content="2023-12-14" />
    <script src="libs/header-attrs-2.24/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/tile-view-0.2.6/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view-0.2.6/tile-view.js"></script>
    <link href="libs/panelset-0.2.6/panelset.css" rel="stylesheet" />
    <script src="libs/panelset-0.2.6/panelset.js"></script>
    <link rel="stylesheet" href="css/nhsr.css" type="text/css" />
    <link rel="stylesheet" href="css/nhsr-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">




class: title-slide, left, bottom

# ç¬¬å…«è®²ï¼šå›¾å½¢è¯­æ³•ä¸æ•°æ®å¯è§†åŒ–
----
## **å‡ ä½•å¯¹è±¡ã€ç¾æœ¯å±æ€§ã€æ ‡å°ºã€æ ‡ç­¾ä¸å›¾ä¾‹ã€ä¸»é¢˜**
### å²å†¬æ³¢
### 2023-12-14

---
# è¯¾å‰å‡†å¤‡

- RåŒ…ggplot2, ggrepel, ggthemes, scales, ggsci, ggpubr

- æ•°æ®EconomistData.csv (dropbox)

---

# å­¦ä¹ ç›®æ ‡

- å›¾å½¢è¯­æ³•çš„æ€æƒ³

- ggplot2çš„åŸºæœ¬è¯­æ³•

- ggplot2ä¿®å›¾çš„æ€è·¯

---

# ä»ä¸€ä¸ªå¯ä»¥ç”»æé¾™çš„åŒ…datasauRusè¯´èµ·

![](08_GG_files/figure-html/08-visaulization-datasau1-1.png)&lt;!-- --&gt;

---

äº‹å‡ºåå¸¸å¿…æœ‰å¦–ï¼å®ƒåŒ…æ‹¬äº†è‹¥å¹²ç»„æè¿°æ€§ç»Ÿè®¡å®Œå…¨ä¸€è‡´ï¼Œä½†æ˜¯åˆ†å¸ƒå´æˆªç„¶ä¸åŒçš„æ•°æ®é›†ã€‚

![](08_GG_files/figure-html/08-visaulization-datasauRus2-1.png)&lt;!-- --&gt;

---


```
## # A tibble: 13 Ã— 6
##    dataset    mean_x mean_y std_dev_x
##    &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;
##  1 away         54.3   47.8      16.8
##  2 bullseye     54.3   47.8      16.8
##  3 circle       54.3   47.8      16.8
##  4 dino         54.3   47.8      16.8
##  5 dots         54.3   47.8      16.8
##  6 h_lines      54.3   47.8      16.8
##  7 high_lines   54.3   47.8      16.8
##  8 slant_down   54.3   47.8      16.8
##  9 slant_up     54.3   47.8      16.8
## 10 star         54.3   47.8      16.8
## 11 v_lines      54.3   47.8      16.8
## 12 wide_lines   54.3   47.8      16.8
## 13 x_shape      54.3   47.8      16.8
## # â„¹ 2 more variables: std_dev_y &lt;dbl&gt;,
## #   corr_x_y &lt;dbl&gt;
```

---

# æ•°æ®å¯è§†åŒ–çš„ç›®çš„

æ•°æ®å¯è§†åŒ–çš„ç›®çš„æ˜¯ç›´è§‚åœ°å‘è¯»è€…ä¼ é€’æ•°æ®ä¸­åŒ…å«çš„ä¿¡æ¯ã€‚é‡è¦çš„äº‹æƒ…è¯´ä¸‰éï¼Œ**ä¼ é€’ä¿¡æ¯ã€ä¼ é€’ä¿¡æ¯ã€ä¼ é€’ä¿¡æ¯**ï¼

--

ä¸€ä¸ªä¼˜ç§€çš„å¯è§†åŒ–åº”è¯¥å…·å¤‡ä»¥ä¸‹çš„ç‰¹å¾ï¼š

--

1. é‡ç‚¹çªå‡ºã€‚è¦è®©è¯»è€…ç¬¬ä¸€çœ¼å°±èƒ½å‘ç°ä½ è¦ä¼ è¾¾çš„ä¸»è¦ä¿¡æ¯ï¼Œè€Œä¸æ˜¯æš—æˆ³æˆ³çš„éšè—èµ·æ¥ï¼Œç­‰å¾…åˆ«äººå‘ç°ã€‚

--

2. è¡¨æ„æ¸…æ™°ã€‚ä¸»è¦ä¿¡æ¯çš„ä¼ é€’è¦æ˜ç¡®æ¸…æ™°ï¼Œä¸è¦äº§ç”Ÿæ­§ä¹‰ï¼Œè®©è¯»è€…è‡ªè¡Œå‘æŒ¥ã€‚å……åˆ†åˆ©ç”¨æ³¨é‡Šã€æ ‡é¢˜ç­‰æ¥é¿å…æ­§ä¹‰ã€‚

--

3. ä¿¡æ¯é‡å¤§ã€‚å›¾å½¢çš„æ ‡é¢˜ã€æ³¨é‡Šéƒ½å¯ä»¥ä¼ è¾¾ä¿¡æ¯ï¼Œåœ¨æœ‰é™çš„å›¾å½¢å†…ï¼Œå°½å¯èƒ½ä¼ é€’æ›´å¤šä¿¡æ¯ã€‚

--

4. é€»è¾‘å®Œæ•´ã€‚æ•°æ®ä¼ é€’çš„ä¿¡æ¯è¦æœ‰é€»è¾‘ï¼Œèƒ½å¤Ÿç‹¬ç«‹é˜…è¯»ã€‚

--

5. ç¾è§‚ã€‚å°½å¯èƒ½å¢å¼ºå›¾å½¢çš„ç¾å­¦æ°´å¹³ï¼Œè®©è¯»è€…æ„¿æ„çœ‹ï¼Œçœ‹ç€èˆ’æœï¼Œæ„¿æ„åˆ†äº«ã€‚

---

# å¦‚ä½•å‘è®¡ç®—æœºæè¿°ä¸€å¼ ç»Ÿè®¡å›¾ï¼Ÿ

&lt;img src="img/08/Economist1.png" width="80%" /&gt;

---

&lt;img src="img/08/Economist2.png" width="90%" /&gt;


---

# å›¾å½¢è¯­æ³•ï¼ˆGrammar of Graphicsï¼‰

--

- Leland Wilkinsonå¼€å‘çš„ä¸€å¥—ç”¨æ¥æè¿°æ‰€æœ‰ç»Ÿè®¡å›¾è¡¨æ·±å±‚ç‰¹æ€§çš„è¯­æ³•è§„åˆ™ï¼Œè¯¥è¯­æ³•å›ç­”äº†**ä»€ä¹ˆæ˜¯ç»Ÿè®¡å›¾**è¿™ä¸€é—®é¢˜

--

- ä»¥è‡ªåº•å‘ä¸Šçš„æ–¹å¼ç»„ç»‡æœ€åŸºæœ¬çš„å…ƒç´ å½¢æˆæ›´é«˜çº§çš„å…ƒç´ 

--

- ä¸€å¼ å›¾å°±æ˜¯ä»æ•°æ®åˆ°å‡ ä½•æ ‡è®°å¯¹è±¡çš„å›¾å½¢å±æ€§çš„ä¸€ç»„æ˜ å°„ï¼Œç»˜åˆ¶åœ¨æŸä¸ªç‰¹å®šçš„åæ ‡ç³»ä¸­

---

æ²¹ç”»ï¼Œç»˜å›¾çš„è¿‡ç¨‹å°±æ˜¯åœ¨ä¸€å¼ ç©ºç™½çš„ç”»å¸ƒä¸Šï¼Œä¸€å±‚ä¸€å±‚åœ°å åŠ å›¾å½¢è¦ç´ 

&lt;img src="img/08/paint.png" width="50%" style="display: block; margin: auto;" /&gt;

---

## GGæ‹†è§£çš„å›¾å½¢è¦ç´ 

--

- **å‡ ä½•å¯¹è±¡**æŒ‡çš„æ˜¯å°†æ•°æ®æ˜ å°„åˆ°å›¾å½¢ä¹‹åçš„å‡ ä½•ç±»å‹ï¼ŒåŒ…æ‹¬ç‚¹ï¼ˆpointï¼‰ã€çº¿ï¼ˆlineï¼‰ã€ç›´æ–¹ï¼ˆhistgramï¼‰ã€æŸ±ï¼ˆbarï¼‰ç­‰ã€‚

--

- **ç¾æœ¯å±æ€§**æŒ‡çš„æ˜¯å‡ ä½•å¯¹è±¡å‘ˆç°åœ¨å›¾å½¢ä¸­çš„å±æ€§ï¼Œä¾‹å¦‚é¢œè‰²ï¼ˆcolorï¼‰ã€å½¢çŠ¶ï¼ˆshapeï¼‰ã€å°ºå¯¸ï¼ˆsizeï¼‰ã€é€æ˜åº¦ï¼ˆalphaï¼‰ç­‰ã€‚å±æ€§è®©åŒä¸€ç±»å‡ ä½•å¯¹è±¡ä¼ é€’æ›´åŠ ä¸°å¯Œçš„ä¿¡æ¯ã€‚

--

- **æ ‡ç­¾æ³¨é‡Š**åŒ…æ‹¬æ ‡é¢˜ï¼ˆtitleï¼‰ã€è½´æ ‡é¢˜ï¼ˆx/y titleï¼‰ã€è½´æ ‡ç­¾ï¼ˆxlab/ylabï¼‰ã€æ–‡æœ¬æ ‡ç­¾ï¼ˆtext labelï¼‰ã€æ³¨é‡Šï¼ˆnoteï¼‰ã€å›¾ä¾‹ï¼ˆlegendï¼‰ç­‰ã€‚å¯ä»¥è¿›ä¸€æ­¥ä¸°å¯Œå›¾å½¢ä¼ è¾¾çš„ä¿¡æ¯ã€‚

æ›´å¤šå…³äºGGçš„å†…å®¹ï¼Œå¯ä»¥å‚è€ƒWilkinsonçš„è‘—ä½œ[The Grammar of Graphics](https://link.springer.com/book/10.1007/0-387-28695-0)ã€‚

---

# ggplot2

å°†GGåœ¨Rè¯­è¨€ä¸­å®ç°çš„åˆæ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„å¤§ç¥Wickhamï¼Œä»–è®¾è®¡äº†`ggplot2`åŒ…ï¼Œ`ggplot2`åŠå…¶å®¶æ—ç°åœ¨å·²ç»æˆä¸ºç»Ÿè®¡åˆ¶å›¾çš„æœ€ä½³å·¥å…·

&lt;img src="img/08/Economist2.png" width="80%" style="display: block; margin: auto;" /&gt;

æœ¬èŠ‚çš„ä»»åŠ¡å°±æ˜¯é€æ­¥å­¦ä¹ `ggplot2`çš„è¦ç´ ï¼Œå¹¶ç”»å‡ºæ­¤å›¾ã€‚æ•™å­¦ææ–™å—åˆ°å“ˆä½›å¤§å­¦[IQSS](http://tutorials.iq.harvard.edu/)çš„å¯å‘

---

## `ggplot`ä½œå›¾çš„è¯­æ³•


```r
ggplot(data = &lt;Data&gt;) +
  &lt;Geom_Function&gt;(mapping = aes(&lt;Mappings&gt;),
  stat = &lt;Stat&gt;,
  position = &lt;Position&gt;) +
  &lt;Coordinate_Function&gt; +
  &lt;Facet_Function&gt; +
  &lt;Scale_Function&gt; +
  &lt;Theme_Function&gt;
```

---

## `ggplot2`çš„è¯­æ³•é€»è¾‘

1. `ggplot`å‡½æ•°æŒ‡å®šæ•°æ®ï¼Œç„¶åä½¿ç”¨`+`å åŠ åç»­ç»˜å›¾åŠ¨ä½œï¼›

2. `geom_`å‡½æ•°æ—ï¼ˆæˆ–è€…`stat_`å‡½æ•°æ—ï¼‰æŒ‡å®šç‰¹å®šç±»å‹çš„å‡ ä½•å¯¹è±¡ï¼›

3. `aes`å‡½æ•°è°ƒèŠ‚å‡ ä½•å¯¹è±¡çš„ç¾æœ¯å±æ€§ï¼›

4. `coordinate_`å‡½æ•°æŒ‡å®šåæ ‡ç³»ç»Ÿï¼ˆå¯ç”¨äºç”»åœ°å›¾ï¼‰ï¼›

5. `facet_`å‡½æ•°è¿›è¡Œåˆ†é¢ï¼›

6. `scale`å‡½æ•°è°ƒèŠ‚åæ ‡å°ºï¼›

7. `theme`ã€`lab`ã€`guide`å‡½æ•°ç­‰è°ƒèŠ‚ä¸»é¢˜ã€æ ‡é¢˜ã€å›¾ä¾‹ç­‰é™„åŠ å±æ€§ã€‚

æ­¤å¤–ï¼Œ`last_plot()`å¯è¿”å›ä¸Šä¸€å¼ å›¾ç‰‡ï¼Œ`ggsave`ç”¨äºå›¾ç‰‡è¾“å‡ºã€‚

---

## å‡ ä½•å¯¹è±¡


```r
economist &lt;- read_csv("data/08/EconomistData.csv")
p1 &lt;- ggplot(economist, aes(x = CPI, y = HDI))
p2 &lt;- p1 + geom_point()
print(p2)
```

&lt;img src="08_GG_files/figure-html/scatter-1.png" width="50%" style="display: block; margin: auto;" /&gt;

ä½¿ç”¨`ggplot`å‡½æ•°æŒ‡å®šç”»å›¾æ•°æ®æ¡†ä¸º`economist`ï¼Œ`aes`å‚æ•°ç”¨äºæŒ‡å®šåº•å›¾çš„xè½´ä¸yè½´å¯¹åº”çš„å˜é‡ï¼Œç„¶åä½¿ç”¨`geom_point`å‡½æ•°ç»˜åˆ¶æ•£ç‚¹å›¾ã€‚


---

é™¤æ•£ç‚¹å›¾å¤–ï¼Œggplotè¿˜æ”¯æŒç±»å‹ä¸°å¯Œçš„å‡ ä½•å¯¹è±¡ï¼Œç°å°†ä¸»è¦ç±»å‹æ€»ç»“å¦‚ä¸‹ï¼š

| å‡ ä½•å¯¹è±¡                | å˜é‡ç±»å‹          | å›¾ç±»å‹                       |
|:---------------------|:---------------|:--------------------------------|
| `geom_blank`        | åˆå§‹åŒ–           | ç©ºç™½ç”»å¸ƒ                           |
| `expand_limits`     | åˆå§‹åŒ–           | æ‰©å±•ç”»å¸ƒèŒƒå›´ä»¥å›Šæ‹¬æ‰€æœ‰æ•°æ®                  |
| `geom_curve`          | åˆå§‹åŒ–           | ä¸€æ¡æ›²çº¿ï¼ŒæŒ‡å®šèµ·æ­¢ç‚¹ä¸å¼§åº¦ |
| `geom_path`           | åˆå§‹åŒ–           | ç‚¹ç»„æˆçš„è·¯å¾„                         |
| `geom_polygon`        | åˆå§‹åŒ–           | å¤šè¾¹å½¢                            |
| `geom_rect`           | åˆå§‹åŒ–           | çŸ©å½¢æˆ–æ–¹å—                          |
| `geom_ribbon`         | åˆå§‹åŒ–           | å¸¦çŠ¶åŒºåŸŸï¼Œå¸¸ç”¨äºè¡¨ç¤ºåŒºåŸŸçš„ä¸ç¡®å®šæ€§æˆ–ç½®ä¿¡åŒºé—´         |
| `geom_abline`         | çº¿æ®µ            | æ–œç›´çº¿                            |
| `geom_hline`         | çº¿æ®µ            | ç«–çº¿                             |
| `geom_vline`          | çº¿æ®µ            | æ¨ªçº¿                             |
| `geom_segment`        | çº¿æ®µ            | æ–œçº¿æ®µ                            |
| `geom_spoke`        | çº¿æ®µ            | åŸºäºåŸç‚¹çš„å‘é‡æˆ–ç®­å¤´ï¼Œå¸¸ç”¨äºæåæ ‡  |

---

| å‡ ä½•å¯¹è±¡                | å˜é‡ç±»å‹          | å›¾ç±»å‹         |
|:---------------------|:---------------|:--------------------------------|
| `geom_area`           | å•è¿ç»­å˜é‡         | å‘åæ ‡è½´çš„åŒºåŸŸ  |
| `geom_density`        | å•è¿ç»­å˜é‡         | æ ¸å¯†åº¦åˆ†å¸ƒå›¾|
| `geom_dotplot`        | å•è¿ç»­å˜é‡         | åˆ†å¸ƒå †å å›¾ï¼Œç‚¹çš„å †å è¡¨ç¤ºç›¸åŒæ•°å€¼çš„é‡å¤æ¬¡æ•°ã€‚         |
| `geom_freqpoly`       | å•è¿ç»­å˜é‡         | é¢‘ç‡å¤šè¾¹å½¢å›¾ï¼Œè¿ç»­å˜é‡çš„é¢‘ç‡åˆ†å¸ƒæƒ…å†µï¼Œæ˜¯ä¸€ç§ç›´æ–¹å›¾çš„æ›¿ä»£æ–¹å¼ |
| `geom_histogram`      | å•è¿ç»­å˜é‡         | åˆ†å¸ƒç›´æ–¹å›¾                          |
| `geom_qq`             | å•è¿ç»­å˜é‡         | Q-Q å›¾ï¼ˆQuantile-Quantile Plotï¼‰  |
| `geom_bar`            | å•ç¦»æ•£å˜é‡         | æ¡å½¢å›¾                            |
| `geom_point`          | åŒè¿ç»­å˜é‡         | æ•£ç‚¹å›¾                            |
| `geom_rug`            | åŒè¿ç»­å˜é‡         | è½´é¡»å›¾ï¼Œä»¥ç±»ä¼¼æ¡å½¢ç çš„æ–¹å¼åœ¨æ•°æ®å¤–ä¾§å±•ç¤ºå˜é‡åˆ†å¸ƒå¯†åº¦     |
| `geom_smooth`         | åŒè¿ç»­å˜é‡         | å¹³æ»‘æ‹Ÿåˆçº¿                     |
| `geom_text`           | åŒè¿ç»­å˜é‡         | ä¸ºæ•£ç‚¹å›¾æ·»åŠ æ–‡æœ¬æ ‡ç­¾      |
| `geom_col`            | ä¸€ä¸ªç¦»æ•£å˜é‡åŠ ä¸€ä¸ªè¿ç»­å˜é‡ | æŸ±çŠ¶å›¾       |

---

&lt;br/&gt;

| å‡ ä½•å¯¹è±¡                | å˜é‡ç±»å‹          | å›¾ç±»å‹         |
|:---------------------|:---------------|:--------------------------------|
| `geom_boxplot`        | ä¸€ä¸ªç¦»æ•£å˜é‡åŠ ä¸€ä¸ªè¿ç»­å˜é‡ | ç®±çº¿å›¾     |
| `geom_violin`         | ä¸€ä¸ªç¦»æ•£å˜é‡åŠ ä¸€ä¸ªè¿ç»­å˜é‡ | å°æç´å›¾  |
| `geom_count`          | åŒç¦»æ•£å˜é‡         | æ•£ç‚¹å¯†åº¦å›¾ï¼Œç‚¹å¤§å°è¡¨è¾¾è¯¥ä½ç½®ç‚¹çš„æ•°é‡|
| `geom_jitter`         | åŒç¦»æ•£å˜é‡         | æŠ–åŠ¨æ•£ç‚¹å›¾ï¼Œå¯¹æ•°æ®è¿›è¡ŒéšæœºæŠ–åŠ¨ï¼Œä»¥å±•ç¤ºç¦»æ•£ç‚¹çš„å¯†åº¦åˆ†å¸ƒæƒ…å†µ  |
| `geom_bin2d`          | åŒå˜é‡           | äºŒç»´ç›´æ–¹å›¾                       |
| `geom_density_2d`     | åŒå˜é‡           | äºŒç»´æ ¸å¯†åº¦å›¾                    |
| `geom_hex`           | åŒå˜é‡           | å…­è¾¹å½¢åˆ†ç®±                      |
| `geom_line`           | åŒå˜é‡           | æŠ˜çº¿å›¾                         |
| `geom_step`           | åŒå˜é‡           | é˜¶æ¢¯å›¾                           |

---

&lt;br/&gt;


| å‡ ä½•å¯¹è±¡                | å˜é‡ç±»å‹          | å›¾ç±»å‹         |
|:---------------------|:---------------|:--------------------------------|
| `geom_crossbar`       | è¯¯å·®å˜é‡          | è¯¯å·®æ¡å›¾                        |
| `geom_errorbar`       | è¯¯å·®å˜é‡          | è¯¯å·®é›·è¾¾å›¾                     |
| `geom_linerange`      | è¯¯å·®å˜é‡          | è¯¯å·®çº¿å›¾                        |
| `geom_pointrange`     | è¯¯å·®å˜é‡          | è¯¯å·®çº¿å›¾ï¼ˆå¸¦å‡å€¼ç‚¹ï¼‰ |
| `geom_map`            | åœ°ç†å˜é‡          | åœ°å›¾                            |
| `geom_contour`        | ä¸‰å˜é‡           | ç­‰é«˜çº¿å›¾                        |
| `geom_contour_filled` | ä¸‰å˜é‡           | ä¸`geom_contour`é…åˆä½¿ç”¨åˆ¶ä½œå¸¦å¡«å……çš„ç­‰é«˜çº¿å›¾    |
| `geom_raster`         | ä¸‰å˜é‡           | æ …æ ¼å›¾                           |
| `geom_tile`           | ä¸‰å˜é‡           | çƒ­åŠ›å›¾                           |

å‚è€ƒhttps://rstudio.github.io/cheatsheets/html/data-visualization.html#geoms

---

## ç¾æœ¯å±æ€§

`aes`å¯ç”¨äºæŒ‡å®šå‡ ä½•å¯¹è±¡çš„ç¾æœ¯å±æ€§ã€‚æŒ‡å®šç¾æœ¯å±æ€§æ—¢å¯ä½¿ç”¨å¸¸é‡ï¼Œä¾‹å¦‚åˆ¶å®šé¢œè‰²ä¸ºçº¢è‰²ï¼ˆredï¼‰;ä¹Ÿå¯ä»¥ä½¿ç”¨å˜é‡ï¼Œä¾‹å¦‚é€šè¿‡å­¦ç§‘ï¼ˆregionï¼‰æ¥èµ‹å€¼é¢œè‰²


```r
p3 &lt;- p1 + geom_point(aes(color = Region))
print(p3)
```

&lt;img src="08_GG_files/figure-html/unnamed-chunk-37-1.png" width="65%" style="display: block; margin: auto;" /&gt;

---

ä½¿ç”¨å¸¸é‡è°ƒæ•´é¢œè‰²


```r
p1 + geom_point(aes(color = "blue"))
```

&lt;img src="08_GG_files/figure-html/unnamed-chunk-38-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

ä½¿ç”¨å¸¸é‡è°ƒæ•´é¢œè‰²æ—¶ï¼Œä¸è°ƒç”¨aeså‡½æ•°


```r
p1 + geom_point(color = "blue")
```

&lt;img src="08_GG_files/figure-html/unnamed-chunk-39-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

### å¸¸ç”¨çš„ç¾å­¦å±æ€§

| å‡ ä½•å¯¹è±¡  | ç¾æœ¯å±æ€§     | ä½œç”¨                                     |
|:-------|:----------|:----------------------------------------|
| all   | color    | é¢œè‰²ï¼Œæ”¯æŒè‰²å·ã€æ–‡æœ¬ç­‰æ–¹å¼èµ‹å€¼                        |
| all   | fill     | å¡«å……é¢œè‰²                                   |
| all   | size     | å¤§å°                                     |
| all   | alpha    | é€æ˜åº¦ |
| line  | linetype | çº¿æ¡ç±»å‹ï¼šæ”¯æŒ0-6å…±ä¸ƒç§ç±»å‹                        |
| line  | lineend  | çº¿æ¡ç»“å°¾ï¼šâ€œroundâ€, â€œbuttâ€ (ç¼ºçœå€¼), â€œsquareâ€   |
| line  | linejoin | çº¿æ¡è¿æ¥å¤„ï¼šâ€œroundâ€ (ç¼ºçœå€¼), â€œmitreâ€, â€œbevelâ€. |
| point | shape    | ç‚¹çš„å½¢çŠ¶ï¼š0-25å…±26ç§å½¢çŠ¶                        |
| point/line | stroke   | å›¾å½¢æˆ–çº¿æ¡çš„è½®å»“|

---

&lt;br/&gt;

| å‡ ä½•å¯¹è±¡  | ç¾æœ¯å±æ€§     | ä½œç”¨                                     |
|:-------|:----------|:----------------------------------------|
| text  | family   | æŒ‡å®šæ–‡æœ¬çš„å­—ä½“                                |
| text  | fontface | æŒ‡å®šå­—ä½“æ ·å¼ï¼š"plain", "bold", "italic"       |
| text  | hjust    | çºµå‘ä½ç½®ï¼štop = 1, middle = 0.5, bottom = 0 |
| text  | vjust    | æ¨ªå‘ä½ç½®ï¼šleft = 0, center = 0.5, right = 1 |

&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
å‚è€ƒï¼šhttps://ggplot2.tidyverse.org/articles/ggplot2-specs.html#colour-and-fill

---


```r
p3 &lt;- p1 + 
  geom_point(shape = 1, size = 2.5, aes(color = Region)) +
  geom_smooth(method = "lm",color = "darkred",
              formula = y~ poly(x, 2),se = FALSE)
print(p3)
```

&lt;img src="08_GG_files/figure-html/unnamed-chunk-40-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---


```r
p4 &lt;- p1 + 
  geom_point(shape = 21,
             size = 3,
             fill = "white",
             stroke = 1.5,
             aes(color = Region)) +
  geom_smooth(method = "lm",
              color = "red",
              aes(linetype = "R^2 = 56%"),
              formula = y~ poly(x, 2),
              se = FALSE)
print(p4)
```

---

&lt;img src="08_GG_files/figure-html/unnamed-chunk-42-1.png" width="100%" style="display: block; margin: auto;" /&gt;

---


```r
dat &lt;- economist %&gt;%
  filter(Country %in% c("New Zealand","Norway","Singapore","Germany","United States",
                        "United Kingdom","Japan","Britain","Barbados","France",
                        "Spain","Botswana","CapVerde","Bhutan",
                        "Rwanda","Italy","Brazil","Greece","China",
                        "South Africa","India","Argentina","Russia",
                        "Venezuela","Iraq","Congo","Myanmar","Sudan","Afghanistan"))
p5 &lt;- p4 + 
  geom_text_repel(data = dat,
                  force = 0.5,
                  hjust = 0.1,
                  size = 2,
                  aes(label = Country),
                  max.overlaps = 30,
                  box.padding = 0.1)
print(p5)
```

---

&lt;img src="08_GG_files/figure-html/unnamed-chunk-44-1.png" width="100%" style="display: block; margin: auto;" /&gt;

---

## ç»Ÿè®¡å˜æ¢

ç»Ÿè®¡å˜æ¢å‡½æ•°ï¼ˆstatistical transformation functionsï¼‰ç”¨äºå¯¹æ•°æ®è¿›è¡Œç»Ÿè®¡è®¡ç®—ã€‚

`stat_summary`å‡½æ•°å¯å°†æ•°æ®æŒ‰ç…§æŒ‡å®šçš„å‡½æ•°è¿›è¡Œæ±‡æ€»ï¼Œä¾‹å¦‚è®¡ç®—å¹³å‡å€¼ã€ä¸­ä½æ•°ç­‰ï¼Œå¹¶å°†æ±‡æ€»ç»“æœç»˜åˆ¶åˆ°å›¾è¡¨ä¸­ã€‚ä¸‹é¢çš„ä»£ç ä¸­ï¼Œ`fun`å‚æ•°æŒ‡å®šäº†è®¡ç®—å‡å€¼ï¼Œ`geom`å‚æ•°åˆ¶å®šäº†è½¬æ¢åçš„é›†åˆå¯¹è±¡

---


```r
ggplot(economist, aes(x = CPI, y = HDI)) +
  stat_summary(fun = mean, geom = "col")
```

&lt;img src="08_GG_files/figure-html/unnamed-chunk-45-1.png" width="90%" style="display: block; margin: auto;" /&gt;

---

&lt;br/&gt;

- `stat_function`ï¼Œå…è®¸å°†æ•°å­¦å‡½æ•°åº”ç”¨åˆ°å›¾å½¢ä¸­ã€‚å¯ä»¥ä½¿ç”¨æ­¤å‡½æ•°ç»˜åˆ¶è‡ªå®šä¹‰å‡½æ•°çš„å›¾å½¢ï¼›

- `stat_ecdf`ï¼Œç»˜åˆ¶ç»éªŒç´¯ç§¯åˆ†å¸ƒå‡½æ•°ï¼Œæ˜¾ç¤ºæ•°æ®çš„ç´¯ç§¯åˆ†å¸ƒæƒ…å†µï¼›

- `stat_contour`ç”¨äºåˆ›å»ºç­‰é«˜çº¿å›¾ï¼Œå±•ç¤ºäºŒç»´æ•°æ®çš„å¯†åº¦åˆ†å¸ƒæƒ…å†µï¼›

- `stat_density`ç”¨äºç»˜åˆ¶æ ¸å¯†åº¦ä¼°è®¡æ›²çº¿ï¼Œå±•ç¤ºæ•°æ®çš„å¯†åº¦åˆ†å¸ƒæƒ…å†µï¼›

- `stat_summary_hex`ç±»ä¼¼äº`stat_summary`ï¼Œç”¨å…­è¾¹å½¢çš„æ–¹å¼å‘ˆç°æ•°æ®çš„æ±‡æ€»ç»“æœã€‚

&lt;br/&gt;

ğŸ”” å°½ç®¡ç»Ÿè®¡è½¬æ¢å‡½æ•°é›†æˆäº†æ•°æ®è½¬æ¢ä¸ç»˜å›¾ï¼Œçœ‹ä¸Šå»æ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†æ˜¯æˆ‘ä»¬æ¨èè¯»è€…å®è·µä¸­è¿˜æ˜¯å°†æ•°æ®è½¬æ¢ä¸ç»˜å›¾åˆ†å¼€ï¼Œè¿™æ ·çš„ä»£ç æ›´ç›´è§‚ï¼Œä¹Ÿæ›´åŠ å®¹æ˜“è°ƒæ•´ã€‚


---

## æ ‡å°º

- `scale_`å‡½æ•°æ—ç”¨äºè°ƒæ•´xè½´ï¼Œyè½´ä»¥åŠæ‰€æœ‰ç¾æœ¯å±æ€§å¯¹åº”å˜é‡çš„å°ºåº¦

- æ˜ç¡®è°ƒæ•´çš„å˜é‡æ˜¯è¿ç»­å˜é‡è¿˜æ˜¯ç¦»æ•£å˜é‡

  - `scale_*_continuous`å°†æ•°æ®çš„è¿ç»­å–å€¼æ˜ å°„ä¸ºå›¾å½¢å±æ€§çš„å–å€¼
  
  - `scale_*_discrete`å°†æ•°æ®çš„ç¦»æ•£å–å€¼æ˜ å°„ä¸ºå›¾å½¢å±æ€§çš„å–å€¼

- `scale_x_(y_)_continuous/discrete`ç”¨äºè°ƒæ•´åæ ‡è½´çš„èŒƒå›´ï¼ˆlimitså‚æ•°ï¼‰ã€åˆ»åº¦ï¼ˆbreaksï¼Œlabelså‚æ•°ï¼‰ä»¥åŠä½ç½®ï¼ˆpositionå‚æ•°ï¼‰ç­‰ç‰¹æ€§

---


```r
p6 &lt;- p5 + 
  scale_x_continuous("Corruption Perceptions Index, 2011 (10 = least corrupt)",
                     breaks = 1:10,
                     limits = c(1,10.2),
                     expand = c(0,0)) +
  scale_y_continuous("Human Development Index, 2011 (1 = best)",
                     breaks = seq(0.2,1,0.1),
                     limits = c(0.2,1.0)) + 
  scale_linetype_discrete(labels = paste0(expression(R^2)," = 56%"))
print(p6)
```

---

&lt;img src="08_GG_files/figure-html/unnamed-chunk-47-1.png" width="100%" style="display: block; margin: auto;" /&gt;
---

### å…¶ä»–å¸¸ç”¨`scale`å‡½æ•°

- `scale_*_binned`å°†æ•°æ®çš„è¿ç»­å–å€¼æ˜ å°„ä¸ºç¦»æ•£çš„ç»Ÿè®¡å †

- `scale_*_identity`ä½¿ç”¨æ•°æ®çš„å€¼ä½œä¸ºå›¾å½¢å±æ€§çš„å–å€¼

- `scale_*_manual(values = c())`å°†æ•°æ®çš„ç¦»æ•£å–å€¼ä½œä¸ºæ‰‹å·¥æŒ‡å®šçš„å›¾å½¢å±æ€§çš„å–å€¼

- `scale_*_date(date_labels = "%m/%d"),date_breaks = "2 weeks")`å°†æ•°æ®å€¼è§†ä¸ºæ—¥æœŸ

- `scale_*_datetime()`å°†æ•°æ®è§†ä¸ºæ—¶é—´ã€‚

- `scale_x_log10`ä»¥log10æ¯”ä¾‹ç»˜åˆ¶xè½´ï¼Œ

- `scale_x_reverse`åè½¬xè½´æ–¹å‘

- `scale_x_sqrt`ä»¥å¹³æ–¹æ ¹ç»˜åˆ¶xã€‚

---


```r
p7 &lt;- p6 + 
  scale_color_manual(values=c("#014d64","#01a2d9","#7ad2f6","#00887d","#ee8f71","#7c260b"),
                     labels=c("Americas","Asia Pacific",
                              "East Europe &amp; Central Asia",
                              "West Europe","East Asia",
                              "South Asia"))
print(p7)
```

---

&lt;img src="08_GG_files/figure-html/unnamed-chunk-49-1.png" width="100%" style="display: block; margin: auto;" /&gt;

---

## åæ ‡ç³»

- `gglot2`é»˜è®¤ä½¿ç”¨ç¬›å¡å°”åæ ‡ç³»

- `coord_fixed`æŒ‡å®šxå’Œyå•ä½ä¹‹é—´å›ºå®šé•¿å®½æ¯”çš„ç¬›å¡å°”åæ ‡

- `coord_polar`ä¸ºæåæ ‡ç³»

- `coord_trans(y = 'sqrt')`ä½¿ç”¨å˜é‡è½¬æ¢åçš„åæ ‡ç³»

- `coord_map`ç”¨äºåœ°ç†ç»˜å›¾ä¸­çš„åæ ‡ç³»

---

## åˆ†é¢

åˆ†é¢ï¼ˆfacetï¼‰æŒ‡çš„æ˜¯æŒ‰ç…§æŸä¸€ä¸ªæˆ–ä¸¤ä¸ªåˆ†ç±»å˜é‡çš„ä¸åŒå€¼å°†æ•°æ®åˆ†ä¸ºè‹¥å¹²ä¸ªå­é›†ï¼Œæ¯ä¸ªæ•°æ®å­é›†åˆ†åˆ«åœ¨åˆ†é¢ä¸Šä½œå›¾ï¼Œä½¿ç”¨`facet_wrap`å¯ä»¥ç›´æ¥åˆ†é¢ï¼Œåˆ†é¢å¯ä»¥ä½¿ç”¨å•ä¸ªå˜é‡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸¤ä¸ªå˜é‡


```r
p1 + geom_point() + facet_wrap(~ Region)
```

&lt;img src="08_GG_files/figure-html/unnamed-chunk-50-1.png" width="50%" style="display: block; margin: auto;" /&gt;

---

## æ ‡ç­¾ä¸å›¾ä¾‹

- `labs`å‡½æ•°ç”¨äºæ ‡è®°å›¾ä¸­çš„å…ƒç´ ï¼Œå…¶`x/y`å‚æ•°æ ‡æ³¨åæ ‡è½´ï¼Œ`title`å‚æ•°æ ‡æ³¨å›¾æ ‡é¢˜ï¼Œ`subtitle`æ ‡æ³¨å›¾çš„å­æ ‡é¢˜ï¼Œ`caption`æ ‡æ³¨å›¾è¯´æ˜ã€‚

- `guides`å‡½æ•°ç”¨äºè®¾ç½®å›¾ä¾‹ï¼Œå¸¸ç”¨çš„åŒ…æ‹¬å–æ¶ˆå›¾ä¾‹ï¼ˆè®¾å®šå¯¹åº”ç¾æœ¯å±æ€§ä¸ºnoneï¼‰ï¼Œä»¥åŠè®¾ç½®å›¾ä¾‹ä½ç½®`theme(legend.position = "bottom")`ã€‚

- `annotate`å‡½æ•°å¯ä»¥ç›´æ¥åœ¨å›¾ä¸Šæ‰‹å·¥æ·»åŠ æ–‡æœ¬

---


```r
p8 &lt;- p7 + 
  labs(title = "Corruption and human development",
       caption = "Source: Transparency International; UN Human Development Report") + 
  guides(colour = guide_legend(title = element_blank()),
         linetype = guide_legend(title = element_blank()))
print(p8)
```

&lt;img src="08_GG_files/figure-html/unnamed-chunk-51-1.png" width="65%" style="display: block; margin: auto;" /&gt;

---

## ä¸»é¢˜

- ä¸€å¼ å›¾é‡Œé¢çš„æ ¼å¼å¯ä»¥ç»Ÿç§°ä¸ºä¸»é¢˜ï¼Œé€šè¿‡`theme`å‡½æ•°å¯ä»¥å¯¹å›¾çš„æ¯ä¸€å¤„ç»†èŠ‚è¿›è¡Œè°ƒæ•´

- themeå‡½æ•°è°ƒç”¨çš„æ–¹å¼ä¸º`theme(element_name = element_function())`

- `element_name`ä¸ºè°ƒæ•´çš„å¯¹è±¡ï¼Œelement_nameæ¶µç›–äº†ç”»é¢ä¸­çš„æ¯ä¸€ä¸ªè¦ç´ 

- `element_function`ä¸ºå…ƒç´ å‡½æ•°

  - `element_text()`ä¸€èˆ¬ç”¨äºæ§åˆ¶æ ‡ç­¾å’Œæ ‡é¢˜çš„å­—ä½“é£æ ¼
  
  - `element_line`ä¸€èˆ¬ç”¨äºæ§åˆ¶çº¿æ¡æˆ–çº¿æ®µçš„é¢œè‰²æˆ–çº¿æ¡ç±»å‹
  
  - `element_rect`ä¸€èˆ¬ç”¨äºæ§åˆ¶èƒŒæ™¯çŸ©å½¢çš„é¢œè‰²æˆ–è€…è¾¹ç•Œçº¿æ¡ç±»å‹
  
  - `element_blank`ä¸åˆ†é…ç›¸åº”çš„ç»˜å›¾ç©ºé—´ï¼Œå³åˆ å»è¿™ä¸ªåœ°æ–¹çš„ç»˜å›¾å…ƒç´ 

- ä¸»é¢˜è°ƒæ•´çš„ç»†èŠ‚éå¸¸å¤šï¼Œæ²¡åŠæ³•ä¸€ä¸€å±•å¼€ï¼Œä¸»è¦é å®è·µï¼Œè®°ä¸ä½çš„ï¼Œå¸®åŠ©æ–‡æ¡£+æœç´¢

---

&lt;br/&gt;

ä¸€äº›å¸¸ç”¨çš„æ ·å¼è¢«å°è£…åœ¨ä¸€äº›ä¸»é¢˜å½“ä¸­ï¼Œä¾‹å¦‚`theme_bw()`ï¼Œ`theme_classic()`ï¼Œ`theme_minimal()`ï¼Œè°ƒç”¨è¿™äº›ä¸»é¢˜ä¼šè¦†ç›–æ‰åŸå…ˆçš„ä¸»é¢˜


```r
p8  + theme_classic()
```

&lt;img src="08_GG_files/figure-html/unnamed-chunk-52-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

`ggthemes`åŒ…æä¾›äº†æ›´ä¸°å¯Œçš„æ ¼å¼ä¸»é¢˜


```r
library(ggthemes)
p8 + theme_stata()
```

![](08_GG_files/figure-html/unnamed-chunk-53-1.png)&lt;!-- --&gt;


```r
p8 + theme_economist()
```

![](08_GG_files/figure-html/unnamed-chunk-54-1.png)&lt;!-- --&gt;

---


```r
p8 + theme_wsj()
```

![](08_GG_files/figure-html/unnamed-chunk-55-1.png)&lt;!-- --&gt;

---

themeçš„å¦ä¸€ç§ç”¨æ³•ä¸ºè®²è‡ªå·±è®¾ç½®çš„æ ¼å¼å‚¨å­˜ä¸ºä¸»é¢˜ï¼Œç”¨äºåç»­çš„å›¾å½¢ä¸­ç®€å•è°ƒç”¨

---


```r
p9 &lt;- p8 + 
  theme(panel.background = element_rect(fill = "white"),
        panel.grid.major.y = element_line(color = "grey",linetype = "solid"),
        panel.grid.major.x = element_blank(),
        axis.line.x = element_line(color = "black"),
        axis.text.x = element_text(color = "black",size = 12),
        axis.ticks.length.x = unit(-0.2, "cm"),
        axis.ticks.length.y = unit(0.5, "cm"),
        axis.ticks.y = element_line(color = "grey"),
        axis.text.y = element_text(color = "black",size = 12),
        axis.title = element_text(face = "italic"),
        plot.caption.position = "plot",
        plot.caption = element_text(hjust = 0),
        legend.position = "top",
        legend.box = "horizontal",
        legend.title = element_blank(),
        legend.key = element_blank(),
        legend.justification=c(-0.15,1)) + 
  guides(colour = guide_legend(nrow = 1,order=1))
print(p9)
```

---

&lt;img src="08_GG_files/figure-html/unnamed-chunk-57-1.png" width="100%" style="display: block; margin: auto;" /&gt;

---

## å‚¨å­˜

ggsave

---

è¯¾åä½œä¸š

- ä¸ç¬¬ä¹è®²ä¸€èµ·

---

æ‹“å±•èµ„æ–™

å¸Œæœ›æ·±å…¥äº†è§£`ggplot2`è¯­æ³•çš„è¯»è€…ï¼Œæ¨èç›´æ¥é˜…è¯»Wickhamçš„è‘—ä½œï¼Œggplot2: Elegant Graphics for Data Analysisï¼Œhttps://ggplot2-book.org/

The R Graph Galleryç½‘é¡µæä¾›äº†ä¸°å¯Œçš„å¯è§†åŒ–æ ·å“ä½œä¸ºå‚è€ƒï¼Œ&lt;https://r-graph-gallery.com/index.html&gt;

---

class: inverse,middle,center
# ä¸€å±‚ä¸€å±‚åˆä¸€å±‚
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "googlecode",
"highlightLines": true,
"highlightLanguage": "r",
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
(function(time) {
  var d2 = function(number) {
    return ('0' + number).slice(-2); // left-pad 0 to minutes/seconds
  },

  time_format = function(total) {
    var secs = Math.abs(total) / 1000;
    var h = Math.floor(secs / 3600);
    var m = Math.floor(secs % 3600 / 60);
    var s = Math.round(secs % 60);
    var res = d2(m) + ':' + d2(s);
    if (h > 0) res = h + ':' + res;
    return res;  // [hh:]mm:ss
  },

  slide_number_div = function(i) {
    return document.getElementsByClassName('remark-slide-number').item(i);
  },

  current_page_number = function(i) {
    return slide_number_div(i).firstChild.textContent;  // text "i / N"
  };

  var timer = document.createElement('span'); timer.id = 'slide-time-left';
  var time_left = time, k = slideshow.getCurrentSlideIndex(),
      last_page_number = current_page_number(k);

  setInterval(function() {
    time_left = time_left - 1000;
    timer.innerHTML = ' ' + time_format(time_left);
    if (time_left < 0) timer.style.color = 'red';
  }, 1000);

  slide_number_div(k).appendChild(timer);

  slideshow.on('showSlide', function(slide) {
    var i = slide.getSlideIndex(), n = current_page_number(i);
    // reset timer when a new slide is shown and the page number is changed
    if (last_page_number !== n) {
      time_left = time; last_page_number = n;
      timer.innerHTML = ' ' + time_format(time); timer.style.color = null;
    }
    slide_number_div(i).appendChild(timer);
  });
})(60000);
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>
<!--Hat-tip: https://www.garrickadenbuie.com/blog/xaringan-tip-logo-all-slides/-->
<style>
.logo {
  background-image: url(img/IDEALAB.jpeg);
  background-size: contain;
  background-repeat: no-repeat;
  position: absolute;
  top: 1em;
  right: 1em;
  width: 110px;
  height: 128px;
  z-index: 0;
}
</style>

<script>
document
  .querySelectorAll(
    '.remark-slide-content' +
    ':not(.title-slide)' +
    // add additional classes to exclude here, e.g.
    ':not(.inverse)' +
    ':not(.hide-logo)'
  )
  .forEach(el => {
    el.innerHTML += '<div class="logo"></div>';
  });
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
